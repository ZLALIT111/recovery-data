<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>שחזור נתונים</title>
  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #f0f2f5;
      --text-color: #333;
      --border-color: #ddd;
      --active-bg: #ffffff;
      --success-bg: #d4edda;
      --success-border: #c3e6cb;
      --success-text: #155724;
      --warning-bg: #fffbe6;
      --warning-border: #ffe58f;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--secondary-color);
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      text-align: right;
      line-height: 1.7;
    }

    .container { max-width: 700px; margin: 0 auto; }
    h1, h2 { color: var(--primary-color); }
    h1 { text-align: center; margin-bottom: 20px; }
    h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; margin-top: 30px; margin-bottom: 15px; }

    .info-section { background-color: white; padding: 25px 35px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
    .intro-text p { font-size: 1.1em; margin: 5px 0; }
    .warning-box { background-color: var(--warning-bg); border: 1px solid var(--warning-border); border-right: 5px solid #ffc107; padding: 15px 20px; }
    .warning-box strong { display: block; margin-bottom: 5px; }
    ul { padding-right: 20px; }
    li { margin-bottom: 10px; }

    /* --- Progress Bar Styles --- */
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      list-style: none;
      padding: 0;
    }
    .progress-step {
      flex: 1;
      text-align: center;
      position: relative;
      cursor: pointer;
      color: #aaa;
      font-weight: bold;
    }
    .progress-step:not(:last-child)::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translateY(-50%);
      height: 2px;
      width: 100%;
      background-color: var(--border-color);
      z-index: -1;
    }
    .progress-step .step-circle {
      width: 30px;
      height: 30px;
      line-height: 30px;
      border-radius: 50%;
      background-color: white;
      border: 2px solid var(--border-color);
      display: inline-block;
      transition: all 0.3s ease;
    }
    .progress-step.completed { color: var(--primary-color); }
    .progress-step.completed:not(.active) .step-circle { background-color: #e6f2ff; border-color: var(--primary-color); }
    .progress-step.completed:not(:last-child)::before { background-color: var(--primary-color); }
    .progress-step.active { color: var(--primary-color); }
    .progress-step.active .step-circle { border-color: var(--primary-color); background-color: var(--primary-color); color: white; }

    /* --- Wizard Form Styling --- */
    .form-step {
        /* This is the key change: steps are hidden by default and shown by JS */
        display: none;
        background-color: var(--active-bg);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        padding: 25px 35px;
        margin-bottom: 25px;
        border-radius: 8px;
        /* Add a transition for smooth appearance */
        opacity: 0;
        transform: translateY(10px);
        animation: fadeIn 0.5s ease forwards;
    }
    
    @keyframes fadeIn {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* First step is visible by default */
    .form-step:first-of-type {
        display: block;
    }

    .form-group label, fieldset legend { display: block; font-weight: bold; margin-bottom: 12px; font-size: 1.2em; }
    .form-group label span, fieldset legend span { color: red; }
    fieldset { border: 1px solid var(--border-color); border-radius: 6px; padding: 15px; margin-top: 10px; }
    legend { padding: 0 10px; font-size: 1.1em; color: var(--text-color); }

    input[type="text"], textarea { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; margin-top: 5px; transition: border-color 0.2s; }
    input[type="text"]:focus, textarea:focus { outline: none; border-color: var(--primary-color); }
    input:focus-visible, textarea:focus-visible { outline: 2px solid var(--primary-color); outline-offset: 2px; }
    input[type="text"]:disabled { background-color: #eee; cursor: not-allowed; }

    .radio-option { margin-bottom: 10px; }
    .radio-option label { font-weight: normal; font-size: 1.05em; }
    
    .form-navigation { display: flex; justify-content: flex-start; margin-top: 20px; } /* Changed to flex-start */
    .nav-btn { background-color: var(--primary-color); color: white; padding: 10px 25px; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; transition: all 0.3s ease; }
    .nav-btn:hover:not(:disabled) { background-color: #0056b3; }
    .nav-btn:disabled { background-color: #a0a0a0; cursor: not-allowed; opacity: 0.7; }
    
    /* --- Conditional Fields, Messages, and Summary --- */
    #remote-availability-group, #other-device-group { display: none; margin-top: 15px; }

    .form-message { padding: 15px; margin-top: 20px; border-radius: 5px; text-align: center; display: none; }
    #success-message { background-color: var(--success-bg); border: 1px solid var(--success-border); color: var(--success-text); }
    #error-message { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    
    #confirm-submit-btn { background-color: #28a745; }
    #confirm-submit-btn:hover:not(:disabled) { background-color: #218838; }
  </style>
</head>
<body>
  <div class="container">
    <div class="info-section">
      <h1>שחזור נתונים</h1>
      <div class="intro-text">
        <p><strong>נמחק לך חומר? </strong></p>
	    <p><strong> הכרטיס זיכרון לא עולה במצלמה? </strong></p>
	    <p><strong>מישהו פירמט בטעות? </strong></p>
	    <p><strong> המחשב דורש לאתחל את הכרטיס? (אל תעשו את זה!)</strong></p>
        <p style="margin-top: 15px;">פנה עכשיו כדי לבדוק אם אפשר לשחזר.</p>
      </div>
    </div>
    <div class="info-section warning-box">
      <strong>שים לב!</strong> כדי למנוע נזק בלתי הפיך לחומר שנמחק, אין להשתמש בהתקן כלל, יש לנתק אותו מהמחשב/מצלמה/נגן ולא להשתמש בו.
    </div>
    <div class="info-section">
      <h2>תנאים, מידע כללי ומחירון</h2>
      <ul>
        <li>המסירה ב<b>בני ברק בלבד</b>. במקרים מסוימים יתאפשר שיחזור בשליטה מרחוק בתוספת 30 ש"ח.</li>
        <li>יש להכין מראש התקן נוסף עם שטח פנוי של <b>לכל הפחות פי 1.5 מכמות החומר שנמחק</b>, אליו ישוחזר החומר. <br><small>[למשל, אם נמחק 20 ג'יגה יש להביא התקן נוסף עם שטח פנוי של לפחות 30 ג'יגה].</small></li>
        <li><b>לא משחזר מדיסק קשיח או דיסק גיבוי חיצוני.</b></li>
      </ul>
      <h3>מחירון</h3>
      <ul>
        <li>עד 100 ג'יגה: <b>50 ש"ח</b></li>
        <li>מעל 100 ג'יגה: <b>תוספת של 1 ש"ח על כל ג'יגה נוסף</b></li>
      </ul>
    </div>
    
    <ul class="progress-bar">
      <li class="progress-step active" data-step="1"><div class="step-circle">1</div></li>
      <li class="progress-step" data-step="2"><div class="step-circle">2</div></li>
      <li class="progress-step" data-step="3"><div class="step-circle">3</div></li>
      <li class="progress-step" data-step="4"><div class="step-circle">4</div></li>
      <li class="progress-step" data-step="5"><div class="step-circle">5</div></li>
      <li class="progress-step" data-step="6"><div class="step-circle">6</div></li>
      <li class="progress-step" data-step="7"><div class="step-circle">✓</div></li>
    </ul>

    <form id="recovery-form" action="https://formspree.io/f/xpwrddgo" method="POST">
      <p style="text-align:center; margin-bottom:20px; font-weight:bold;">כדי שנוכל לעזור, אנא מלא את הפרטים הבאים (<span style="color:red;">*</span> חובה):</p>
      
      <!-- Step 1 -->
      <div class="form-step" id="step-1" data-step="1">
        <div class="form-group">
          <label>1/7: באיזה התקן מדובר? <span>*</span></label>
          <div class="radio-option"><input type="radio" id="sdcard" name="device_type" value="כרטיס זיכרון" required> <label for="sdcard">כרטיס זיכרון</label></div>
          <div class="radio-option"><input type="radio" id="usb" name="device_type" value="דיסק אונקי"> <label for="usb">דיסק אונקי</label></div>
          <div class="radio-option"><input type="radio" id="other" name="device_type" value="אחר"> <label for="other">אחר</label></div>
          <div id="other-device-group">
            <input type="text" id="device_type_other" name="device_type_other" placeholder="נא לפרט">
          </div>
        </div>
        <div class="form-navigation">
          <button type="button" class="nav-btn next-btn">המשך</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="form-step" id="step-2" data-step="2">
        <div class="form-group">
          <label for="device-size">2/7: מה גודל ההתקן כולו (בג'יגה)? <span>*</span></label>
          <input type="text" id="device-size" name="device_size" placeholder="לדוגמה: 64" required>
        </div>
         <div class="form-navigation">
          <button type="button" class="nav-btn next-btn">המשך</button>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="form-step" id="step-3" data-step="3">
        <div class="form-group">
          <label>3/7: כמה ג'יגה נמחק (בערך)? <span>*</span></label>
          <div class="radio-option"><input type="radio" id="size-under-100" name="deleted_size" value="פחות מ-100 ג'יגה" required> <label for="size-under-100">פחות מ-100</label></div>
          <div class="radio-option"><input type="radio" id="size-over-100" name="deleted_size" value="יותר מ-100 ג'יגה"> <label for="size-over-100">יותר מ-100</label></div>
          <div class="radio-option"><input type="radio" id="size-unknown" name="deleted_size" value="לא יודע"> <label for="size-unknown">לא יודע</label></div>
        </div>
        <div class="form-navigation">
          <button type="button" class="nav-btn next-btn">המשך</button>
        </div>
      </div>

      <!-- Step 4 -->
      <div class="form-step" id="step-4" data-step="4">
        <div class="form-group">
          <label for="description">4/7: תאר בקצרה מה קרה <span>*</span></label>
          <textarea id="description" name="description" placeholder="לדוגמה: הכרטיס הראה שגיאה במצלמה..." required></textarea>
        </div>
        <div class="form-navigation">
          <button type="button" class="nav-btn next-btn">המשך</button>
        </div>
      </div>
      
      <!-- Step 5 -->
      <div class="form-step" id="step-5" data-step="5">
          <div class="form-group">
          <label for="contact-info">5/7: פרטי יצירת קשר (מייל או טלפון) <span>*</span></label>
          <input type="text" id="contact-info" name="contact_info" required>
        </div>
        <div class="form-navigation">
          <button type="button" class="nav-btn next-btn">המשך</button>
        </div>
      </div>

      <!-- Step 6 -->
      <div class="form-step" id="step-6" data-step="6">
        <fieldset>
          <legend>6/7: שירות והערות <span>*</span></legend>
          <p style="margin-top:0;"><strong>איך תרצה לקבל שירות?</strong></p>
          <div class="radio-option"><input type="radio" id="delivery" name="service_type" value="מסירת התקן" required> <label for="delivery">מסירת ההתקן (בני ברק בלבד)</label></div>
          <div class="radio-option"><input type="radio" id="remote" name="service_type" value="שחזור בשליטה מרחוק (+30 שח)"> <label for="remote">שיחזור בשליטה מרחוק</label></div>
          <div id="remote-availability-group">
            <label for="availability">בחרת בשליטה מרחוק, מתי תהיה זמין?</label>
            <input type="text" id="availability" name="availability" placeholder="לדוגמה: ימי שלישי, 18:00-22:00">
          </div>
        </fieldset>
        <fieldset>
            <legend>הערות נוספות (אופציונלי)</legend>
            <textarea id="notes" name="notes" placeholder="כל מידע נוסף שיכול לעזור..."></textarea>
        </fieldset>
        <div class="form-navigation">
          <button type="button" class="nav-btn next-btn">המשך לאישור</button>
        </div>
      </div>
      
      <!-- Step 7: Final Confirmation (Editable) -->
      <div class="form-step" id="step-7" data-step="7">
        <h2>אישור סופי ושליחה</h2>
        <p>כל הפרטים שמילאת גלויים כעת. אנא גלול למעלה ובדוק שהכל תקין לפני השליחה. באפשרותך לערוך כל שדה.</p>
        <div class="form-navigation">
          <!-- The previous button is gone. The user can just scroll up to edit. -->
          <button type="submit" class="nav-btn" id="confirm-submit-btn">אשר ושלח</button>
        </div>
      </div>
    </form>
    
    <div id="success-message" class="form-message" tabindex="-1">
      <strong>תודה!</strong><br>
      פרטיך נשלחו בהצלחה. ניצור איתך קשר בהקדם.
    </div>
    <div id="error-message" class="form-message">
      <strong>אופס! משהו השתבש.</strong><br>
      לא ניתן היה לשלוח את הטופס. אנא נסה שוב מאוחר יותר או פנה אלינו בדרך אחרת.
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById('recovery-form');
  const steps = Array.from(form.querySelectorAll('.form-step'));
  const progressBarSteps = Array.from(document.querySelectorAll('.progress-bar .progress-step'));
  const finalSubmitBtn = document.getElementById('confirm-submit-btn');
  let currentStep = 1;

  // --- Core Logic for Progressive Form ---

  const updateProgressBar = () => {
    progressBarSteps.forEach((step, index) => {
      const stepNum = index + 1;
      step.classList.toggle('completed', stepNum < currentStep);
      step.classList.toggle('active', stepNum === currentStep);
    });
  };

  const showNextStep = () => {
    // Hide the 'continue' button of the now-completed step
    const completedStep = steps[currentStep - 1];
    const nav = completedStep.querySelector('.form-navigation');
    if (nav) {
      nav.style.display = 'none';
    }

    currentStep++;

    // Show the new current step
    if (currentStep <= steps.length) {
      const nextStepElement = document.getElementById(`step-${currentStep}`);
      if (nextStepElement) {
        nextStepElement.style.display = 'block';
        // Scroll to the new step
        nextStepElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        validateStep(nextStepElement); // Validate the new step to set button state
      }
    }
    
    updateProgressBar();
    validateEntireForm(); // Check if final submit can be enabled
  };

  // --- Validation Logic ---

  const validateStep = (stepElement) => {
    const nextBtn = stepElement.querySelector('.next-btn');
    if (!nextBtn) return true; // No validation needed if no next button

    let isStepValid = true;
    const inputs = stepElement.querySelectorAll('input[required], textarea[required]');
    
    inputs.forEach(input => {
      // For radio buttons, check if one in the group is selected
      if (input.type === 'radio') {
        const groupName = input.name;
        if (!form.querySelector(`input[name="${groupName}"]:checked`)) {
          isStepValid = false;
        }
      } else if (!input.value.trim()) {
        isStepValid = false;
      }
    });
    
    nextBtn.disabled = !isStepValid;
    return isStepValid;
  };

  const validateEntireForm = () => {
      let isFormValid = true;
      // The final step is just a submit button, so we check up to step.length - 1
      for (let i = 0; i < steps.length - 1; i++) {
          if (!validateStep(steps[i])) {
              isFormValid = false;
              // We don't break, because we want to run validateStep on all to set button states
          }
      }
      finalSubmitBtn.disabled = !isFormValid;
  };

  // --- Event Listeners ---

  form.addEventListener('click', e => {
    if (e.target.matches('.next-btn') && !e.target.disabled) {
      showNextStep();
    }
  });

  // Clicking on the progress bar scrolls to the step
  progressBarSteps.forEach((stepEl) => {
    stepEl.addEventListener('click', () => {
      const targetStepNum = parseInt(stepEl.dataset.step);
      const targetStepElement = document.getElementById(`step-${targetStepNum}`);
      // Allow scrolling only to revealed steps
      if (targetStepElement && targetStepElement.style.display === 'block') {
         targetStepElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // Add real-time validation to all inputs
  form.querySelectorAll('input, textarea').forEach(input => {
    const eventType = (input.type === 'radio' || input.type === 'checkbox') ? 'change' : 'input';
    input.addEventListener(eventType, () => {
        const parentStep = input.closest('.form-step');
        if (parentStep) {
            validateStep(parentStep);
        }
        validateEntireForm();
    });
  });

  // Conditional Logic Handler (for fields that show/hide other fields)
  const handleConditionalFields = () => {
    // 'Other' device type
    const otherRadio = document.getElementById('other');
    const otherDeviceGroup = document.getElementById('other-device-group');
    const otherDeviceInput = document.getElementById('device_type_other');
    if (otherRadio && otherDeviceGroup && otherDeviceInput) {
        otherDeviceGroup.style.display = otherRadio.checked ? 'block' : 'none';
        otherDeviceInput.required = otherRadio.checked;
    }
    
    // 'Remote' service type
    const remoteRadio = document.getElementById('remote');
    const remoteGroup = document.getElementById('remote-availability-group');
    const availabilityInput = document.getElementById('availability');
    if(remoteRadio && remoteGroup && availabilityInput) {
        remoteGroup.style.display = remoteRadio.checked ? 'block' : 'none';
        availabilityInput.required = remoteRadio.checked;
    }
    
    // Re-validate the steps after a change
    validateStep(document.getElementById('step-1'));
    validateStep(document.getElementById('step-6'));
    validateEntireForm();
  };

  form.querySelectorAll('input[type="radio"]').forEach(radio => radio.addEventListener('change', handleConditionalFields));

  // AJAX Form Submission (No changes needed here)
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    finalSubmitBtn.disabled = true;
    finalSubmitBtn.textContent = 'שולח...';

    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: { 'Accept': 'application/json' }
    }).then(response => {
      if (response.ok) {
        form.style.display = 'none';
        document.querySelector('.progress-bar').style.display = 'none';
        document.getElementById('success-message').style.display = 'block';
        window.scrollTo(0, 0);
	
      } else {
         throw new Error('Network response was not ok.');
      }
    }).catch(error => {
      document.getElementById('error-message').style.display = 'block';
      finalSubmitBtn.disabled = false;
      finalSubmitBtn.textContent = 'אשר ושלח';
    });
  });

  // --- Initial Setup ---
  // Hide all but the first step
  steps.forEach((step, index) => {
    if (index > 0) {
      step.style.display = 'none';
    }
  });

  // Initial validation
  validateStep(steps[0]);
  validateEntireForm();
  handleConditionalFields();
});
</script>

</body>
</html>